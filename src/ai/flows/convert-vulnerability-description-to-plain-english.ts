
'use server';

/**
 * @fileOverview Converts technical vulnerability descriptions into plain English.
 *
 * - convertVulnerabilityDescriptionToPlainEnglish - A function that converts technical vulnerability descriptions into plain English.
 * - ConvertVulnerabilityDescriptionToPlainEnglishInput - The input type for the convertVulnerabilityDescriptionToPlainEnglish function.
 * - ConvertVulnerabilityDescriptionToPlainEnglishOutput - The return type for the convertVulnerabilityDescriptionToPlainEnglish function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const ConvertVulnerabilityDescriptionToPlainEnglishInputSchema = z.object({
  technicalDescription: z
    .string()
    .describe('The technical description of the vulnerability.'),
});
export type ConvertVulnerabilityDescriptionToPlainEnglishInput = z.infer<
  typeof ConvertVulnerabilityDescriptionToPlainEnglishInputSchema
>;

const ConvertVulnerabilityDescriptionToPlainEnglishOutputSchema = z.object({
  plainEnglishDescription: z
    .string()
    .describe('The plain English description of the vulnerability.'),
});
export type ConvertVulnerabilityDescriptionToPlainEnglishOutput = z.infer<
  typeof ConvertVulnerabilityDescriptionToPlainEnglishOutputSchema
>;

export async function convertVulnerabilityDescriptionToPlainEnglish(
  input: ConvertVulnerabilityDescriptionToPlainEnglishInput
): Promise<ConvertVulnerabilityDescriptionToPlainEnglishOutput> {
  return convertVulnerabilityDescriptionToPlainEnglishFlow(input);
}

const prompt = ai.definePrompt({
  name: 'convertVulnerabilityDescriptionToPlainEnglishPrompt',
  input: {
    schema: ConvertVulnerabilityDescriptionToPlainEnglishInputSchema,
  },
  output: {
    schema: ConvertVulnerabilityDescriptionToPlainEnglishOutputSchema,
  },
  prompt: `You are an expert security communicator.

You will receive a technical description of a vulnerability.
Your task is to translate the technical description into plain English so that a non-technical stakeholder can understand the risks and implications without needing specialized security knowledge.

Technical Description: {{{technicalDescription}}}`,
});

const convertVulnerabilityDescriptionToPlainEnglishFlow = ai.defineFlow(
  {
    name: 'convertVulnerabilityDescriptionToPlainEnglishFlow',
    inputSchema: ConvertVulnerabilityDescriptionToPlainEnglishInputSchema,
    outputSchema: ConvertVulnerabilityDescriptionToPlainEnglishOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    if (!output) {
      console.error('AI prompt for convertVulnerabilityDescriptionToPlainEnglish did not return an output.');
      throw new Error('AI model failed to generate a response matching the required schema.');
    }
    return output;
  }
);
